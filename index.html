<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>RakStore</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <!-- Подключаем иконки (FontAwesome) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        :root {
            --bg-color: #1c1c1e;
            --card-bg: #2c2c2e;
            --text-color: #ffffff;
            --accent-red: #ff3b30;
            --secondary-text: #8e8e93;
            --green: #30d158;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            margin: 0;
            padding: 0;
            padding-bottom: 80px; /* Место для нижнего меню */
            overflow-x: hidden;
        }

        /* --- HEADER --- */
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            background-color: var(--card-bg);
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }

        .brand {
            font-size: 24px;
            font-weight: 900;
            color: var(--accent-red);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .burger {
            font-size: 24px;
            cursor: pointer;
            color: var(--text-color);
        }

        /* --- SIDEBAR MENU --- */
        .sidebar-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 199;
            display: none;
        }
        
        .sidebar {
            position: fixed;
            top: 0; right: -80%; /* Скрыто справа */
            width: 70%;
            height: 100%;
            background-color: var(--card-bg);
            z-index: 200;
            transition: 0.3s;
            padding-top: 60px;
            display: flex;
            flex-direction: column;
        }

        .sidebar.active {
            right: 0;
        }

        .sidebar-item {
            padding: 15px 20px;
            border-bottom: 1px solid rgba(255,255,255,0.05);
            font-size: 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        .sidebar-item:active { background-color: rgba(255,255,255,0.1); }
        .sidebar-close {
            position: absolute; top: 15px; right: 20px;
            font-size: 24px; cursor: pointer;
        }

        /* --- MAIN CONTENT --- */
        .page { display: none; padding: 20px; animation: fadeIn 0.3s; }
        .page.active { display: block; }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* Level Card */
        .level-card {
            background: linear-gradient(135deg, #ff3b30, #ff9f0a);
            padding: 20px;
            border-radius: 20px;
            margin-bottom: 20px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(255, 59, 48, 0.4);
        }
        
        .level-title { font-size: 14px; opacity: 0.9; text-transform: uppercase; }
        .discount-big { font-size: 48px; font-weight: bold; margin: 10px 0; }
        .xp-bar-bg { background: rgba(0,0,0,0.2); height: 8px; border-radius: 4px; overflow: hidden; margin-top: 10px; }
        .xp-bar-fill { background: white; height: 100%; width: 0%; transition: 1s; }
        .level-info { margin-top: 5px; font-size: 12px; display: flex; justify-content: space-between; }

        /* Stats Grid */
        .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px; }
        .stat-box { background: var(--card-bg); padding: 15px; border-radius: 15px; text-align: center; }
        .stat-val { font-size: 20px; font-weight: bold; color: var(--accent-red); }
        .stat-label { font-size: 12px; color: var(--secondary-text); }

        /* Warranty Item */
        .warranty-item {
            background: var(--card-bg);
            padding: 15px;
            border-radius: 15px;
            margin-bottom: 10px;
            border-left: 4px solid var(--green);
        }
        .warranty-header { display: flex; justify-content: space-between; margin-bottom: 5px; }
        .warranty-time { color: var(--green); font-size: 14px; }

        /* Admin Inputs */
        input, select {
            width: 100%; padding: 12px; margin-bottom: 10px;
            background: #1c1c1e; border: 1px solid #3a3a3c;
            color: white; border-radius: 8px; box-sizing: border-box;
        }
        button.btn-primary {
            width: 100%; padding: 15px;
            background: var(--accent-red); color: white;
            border: none; border-radius: 10px; font-weight: bold;
            font-size: 16px; cursor: pointer;
        }

        /* --- BOTTOM NAVIGATION --- */
        .bottom-nav {
            position: fixed; bottom: 0; left: 0; width: 100%;
            background: var(--card-bg);
            display: flex; justify-content: space-around;
            padding: 12px 0;
            border-top: 1px solid rgba(255,255,255,0.05);
            z-index: 90;
        }
        .nav-item {
            display: flex; flex-direction: column; align-items: center;
            font-size: 10px; color: var(--secondary-text); gap: 4px; cursor: pointer;
        }
        .nav-item.active { color: var(--accent-red); }
        .nav-item i { font-size: 20px; }

    </style>
</head>
<body>

    <!-- Header -->
    <header>
        <div class="brand">RakStore</div>
        <div class="burger" onclick="toggleSidebar()"><i class="fas fa-bars"></i></div>
    </header>

    <!-- Sidebar Overlay & Menu -->
    <div class="sidebar-overlay" onclick="toggleSidebar()"></div>
    <div class="sidebar" id="sidebar">
        <div class="sidebar-close" onclick="toggleSidebar()">&times;</div>
        <div class="sidebar-item" onclick="navTo('home')"><i class="fas fa-home"></i> Главная</div>
        <div class="sidebar-item" onclick="navTo('profile')"><i class="fas fa-user"></i> Профиль</div>
        <div class="sidebar-item" onclick="navTo('members')"><i class="fas fa-users"></i> Участники</div>
        <div class="sidebar-item" onclick="navTo('history')"><i class="fas fa-shopping-bag"></i> История покупок</div>
        <div class="sidebar-item" onclick="alert('Уведомлений нет')"><i class="fas fa-bell"></i> Уведомления</div>
        <div class="sidebar-item" onclick="alert('Лидерборд в разработке')"><i class="fas fa-trophy"></i> Лидерборд</div>
        <div class="sidebar-item" onclick="navTo('achievements')"><i class="fas fa-medal"></i> Достижения</div>
        <div class="sidebar-item" onclick="alert('RakStore v1.0')"><i class="fas fa-info-circle"></i> О проекте</div>
        <div style="margin-top: auto;"></div> <!-- Spacer -->
        <div class="sidebar-item" style="color: var(--accent-red);" onclick="navTo('admin')"><i class="fas fa-cogs"></i> Админ панель</div>
    </div>

    <!-- Страница: ГЛАВНАЯ -->
    <div id="home" class="page active">
        <!-- Блок скидки -->
        <div class="level-card">
            <div class="level-title">Ваш уровень: <span id="lvl-display">1</span></div>
            <div class="discount-big" id="discount-display">5%</div>
            <div class="xp-bar-bg">
                <div class="xp-bar-fill" id="xp-fill"></div>
            </div>
            <div class="level-info">
                <span id="xp-current">0 XP</span>
                <span id="xp-next">100 XP</span>
            </div>
        </div>

        <h3>Статистика</h3>
        <div class="stats-grid">
            <div class="stat-box">
                <div class="stat-val" id="stat-purchases">0</div>
                <div class="stat-label">Покупок</div>
            </div>
            <div class="stat-box">
                <div class="stat-val" id="stat-spent">0₽</div>
                <div class="stat-label">Потрачено</div>
            </div>
        </div>

        <h3>Быстрые действия</h3>
        <p style="color: #888; font-size: 14px;">Выберите действие в меню снизу.</p>
    </div>

    <!-- Страница: ПРОФИЛЬ -->
    <div id="profile" class="page">
        <h2>Профиль</h2>
        <p>Имя: <span id="username">Загрузка...</span></p>
        <p>ID: <span id="userid">...</span></p>
    </div>

    <!-- Страница: ИСТОРИЯ ПОКУПОК -->
    <div id="history" class="page">
        <h2>Мои покупки</h2>
        <div id="history-list">
            <!-- Сюда JS добавит покупки -->
            <p style="color: gray">Покупок пока нет.</p>
        </div>
    </div>

    <!-- Страница: УЧАСТНИКИ -->
    <div id="members" class="page">
        <h2>Участники</h2>
        <p>Список участников (Демо)</p>
    </div>

    <!-- Страница: ДОСТИЖЕНИЯ -->
    <div id="achievements" class="page">
        <h2>Достижения</h2>
        <div class="stat-box" style="text-align: left; display: flex; align-items: center; gap: 15px;">
            <i class="fas fa-star" style="color: gold; font-size: 24px;"></i>
            <div>
                <b>Новичок</b><br>
                <span style="font-size: 12px; color: gray;">Зайдите в приложение первый раз.</span>
            </div>
        </div>
    </div>

    <!-- Страница: АДМИН ПАНЕЛЬ -->
    <div id="admin" class="page">
        <h2 style="color: var(--accent-red)">Админ Панель</h2>
        <p style="font-size: 12px; color: gray;">Редактирование данных (сохраняется локально)</p>
        
        <h4>Добавить опыт (тест скидки)</h4>
        <input type="number" id="admin-xp" placeholder="Количество XP (например 150)">
        <button class="btn-primary" onclick="adminAddXP()">Начислить опыт</button>

        <h4>Добавить покупку (гарантия)</h4>
        <input type="text" id="admin-item" placeholder="Название товара">
        <input type="text" id="admin-price" placeholder="Цена">
        <select id="admin-warranty">
            <option value="Forever">Навсегда</option>
            <option value="30 Days">30 Дней</option>
        </select>
        <br><br>
        <button class="btn-primary" onclick="adminAddPurchase()">Выдать покупку</button>
    </div>

    <!-- Bottom Navigation -->
    <nav class="bottom-nav">
        <div class="nav-item active" onclick="navTo('home')"><i class="fas fa-home"></i>Главная</div>
        <div class="nav-item" onclick="navTo('profile')"><i class="fas fa-user"></i>Профиль</div>
        <div class="nav-item" onclick="navTo('members')"><i class="fas fa-users"></i>Участники</div>
        <div class="nav-item" onclick="navTo('achievements')"><i class="fas fa-chart-bar"></i>Статы</div>
    </nav>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        // --- ДАННЫЕ (Имитация Базы Данных) ---
        // Загружаем из памяти или создаем новые
        let user = JSON.parse(localStorage.getItem('rakstore_user')) || {
            xp: 0,
            purchases: [],
            spent: 0
        };

        // --- ЛОГИКА ---

        function saveUser() {
            localStorage.setItem('rakstore_user', JSON.stringify(user));
            updateUI();
        }

        // Расчет уровня: каждые 100 XP = 1 уровень
        function getLevelInfo() {
            let level = Math.floor(user.xp / 100) + 1;
            let discount = level * 5; // 5% за уровень
            let xpForNext = level * 100;
            let xpCurrentLevel = user.xp % 100;
            return { level, discount, xpForNext, xpCurrentLevel };
        }

        function updateUI() {
            const info = getLevelInfo();
            
            // Обновляем карточку скидки
            document.getElementById('lvl-display').innerText = info.level;
            document.getElementById('discount-display').innerText = info.discount + '%';
            document.getElementById('xp-current').innerText = info.xpCurrentLevel + ' XP';
            document.getElementById('xp-next').innerText = ' / 100 XP';
            
            // Полоска прогресса
            let percent = (info.xpCurrentLevel / 100) * 100;
            document.getElementById('xp-fill').style.width = percent + '%';

            // Статистика
            document.getElementById('stat-purchases').innerText = user.purchases.length;
            document.getElementById('stat-spent').innerText = user.spent + '₽';

            // История покупок
            renderHistory();
        }

        function renderHistory() {
            const container = document.getElementById('history-list');
            if (user.purchases.length === 0) {
                container.innerHTML = '<p style="color: gray">Покупок пока нет.</p>';
                return;
            }
            container.innerHTML = '';
            user.purchases.forEach(p => {
                let div = document.createElement('div');
                div.className = 'warranty-item';
                div.innerHTML = `
                    <div class="warranty-header">
                        <b>${p.name}</b>
                        <span>${p.price}₽</span>
                    </div>
                    <div class="warranty-time"><i class="fas fa-shield-alt"></i> Гарантия: ${p.warranty}</div>
                `;
                container.appendChild(div);
            });
        }

        // --- НАВИГАЦИЯ ---

        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('active');
            let overlay = document.querySelector('.sidebar-overlay');
            overlay.style.display = overlay.style.display === 'block' ? 'none' : 'block';
        }

        function navTo(pageId) {
            // Скрыть все страницы
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            // Показать нужную
            document.getElementById(pageId).classList.add('active');
            
            // Закрыть сайдбар если открыт
            document.getElementById('sidebar').classList.remove('active');
            document.querySelector('.sidebar-overlay').style.display = 'none';

            // Обновить нижнее меню
            document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
            // Простая логика подсветки (можно улучшить по ID)
        }

        // --- АДМИН ФУНКЦИИ (СИМУЛЯЦИЯ) ---

        function adminAddXP() {
            let val = parseInt(document.getElementById('admin-xp').value);
            if (val) {
                user.xp += val;
                saveUser();
                alert('Опыт начислен! Проверьте главную.');
                navTo('home');
            }
        }

        function adminAddPurchase() {
            let name = document.getElementById('admin-item').value;
            let price = parseInt(document.getElementById('admin-price').value);
            let warranty = document.getElementById('admin-warranty').value;

            if (name && price) {
                user.purchases.push({ name, price, warranty });
                user.spent += price;
                saveUser();
                alert('Покупка выдана!');
                navTo('history');
            } else {
                alert('Заполните данные');
            }
        }

        // --- ИНИЦИАЛИЗАЦИЯ ---
        if (tg.initDataUnsafe && tg.initDataUnsafe.user) {
            document.getElementById('username').innerText = tg.initDataUnsafe.user.first_name;
            document.getElementById('userid').innerText = tg.initDataUnsafe.user.id;
        }
        updateUI();

    </script>
</body>
</html>
